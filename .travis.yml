language: node_js

node_js:
  - '12'
  - '14'
  - '15'
  - 'node'

dist: focal
sudo: required

matrix:
  fast_finish: true

install:
  - sudo ln -s /usr/lib/x86_64-linux-gnu/libtommath.so.1 /usr/lib/x86_64-linux-gnu/libtommath.so.0
  - wget -O Firebird-4.0.0.2353-ReleaseCandidate1.amd64.tar.gz "https://github.com/FirebirdSQL/firebird/releases/download/T4_0_0_RC1/Firebird-4.0.0.2353-ReleaseCandidate1.amd64.tar.gz"
  - tar xzvf Firebird-4.0.0.2353-ReleaseCandidate1.amd64.tar.gz
  - (cd Firebird-4.0.0.2353-ReleaseCandidate1.amd64; sudo ./install.sh -silent)
  - sudo usermod -a -G firebird travis

script:
  - yarn
  - yarn bootstrap
  - sg firebird -c "LD_LIBRARY_PATH=/usr/lib64 yarn test"

cache:
  directories:
    - node_modules

git:
  depth: 1

addons:
  apt:
    packages:
      - libtommath1
      - libtomcrypt1
